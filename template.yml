AWSTemplateFormatVersion: "2010-09-09"
Transform: AWS::Serverless-2016-10-31
Parameters:
  CodeUriBucket:
    Description: "Required. The S3 bucket where the lambda code resides."
    Type: "String"
Globals:
  Api:
    EndpointConfiguration: EDGE
    Cors:
      AllowMethods: "'DELETE,GET,HEAD,OPTIONS,PATCH,POST,PUT'"
      AllowHeaders: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'"
      AllowOrigin: "'*'"
Resources:
  postsDynamoDBTable:
    Type: AWS::DynamoDB::Table
    Properties:
      AttributeDefinitions:
        - AttributeName: "id"
          AttributeType: "S"
      KeySchema:
        - AttributeName: "id"
          KeyType: "HASH"
      ProvisionedThroughput:
        ReadCapacityUnits: "5"
        WriteCapacityUnits: "5"
      TableName: "posts"
  EdnaBlogFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: serverless-blog-back
      Runtime: go1.x
      CodeUri:
        Bucket: !Ref CodeUriBucket
        Key: serverless-blog-back.zip
      Events:
        EdnaBlogApiGetAll:
          Type: Api
          Properties:
            Path: /posts
            Method: GET
        EdnaBlogApiOptions:
          Type: Api
          Properties:
            Path: /posts
            Method: OPTIONS
        EdnaBlogApiGet:
          Type: Api
          Properties:
            Path: /posts/{id+}
            Method: GET
        EdnaBlogApiDelete:
          Type: Api
          Properties:
            Path: /posts/{id+}
            Method: DELETE
        EdnaBlogApiPut:
          Type: Api
          Properties:
            Path: /posts
            Method: PUT
        EdnaBlogApiPost:
          Type: Api
          Properties:
            Path: /posts
            Method: POST
